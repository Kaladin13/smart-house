## Внутренний дизайн

***

### Основная цель - максимальная пропускная способность.

+ Для этой цели все процессы(корутины) логически разбиваются на 4 слоя, образуя конвеер:
    1. Poller - вынимает задачи пачками из очереди и публикует их для всех Consumer-ов
    2. Consumer - обходит всех Poller-ов и набирает свою пачку задач (если их слишком мало использает flush по истечению
       времени)
    3. House - собственно сам дом. Принимает задачу от Consumer-ов и посывает отчёт на публикацию
    4. Publisher - набирает отчёты от домов в пачки и публикует их в другую очередь (в случае их малого числа -
       испульзует flush по истечению времени)

    + Каждый слой общается с соседними при помощи Switch-ей, по сути представлящих обёртку над `List<Channel<T>>`
+ Конвеер адаптивный: в случае наличия большого числа запросов, они обрабатываюстя пачками, иначе - таймеры "
  проталкивают" дальше по нему, "что остаётся".
+ Таким образом весь сервис выступает одним большим Pipe-ом между двумя Redis очередями.
  ![Picture](https://raw.githubusercontent.com/Kaladin13/smart-house/iot-dev/backend/iot/iot-diag.svg)
